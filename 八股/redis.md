# redis数据结构

String 动态字符串，int

list 双向链表，压缩列表

set 哈希

sortset 跳表和哈希

hash 哈希和压缩

bitmap 字节数组

geo



## 单点redis不够用怎么办

读写分离

分库分表；部署 Redis Cluster 集群，Redis Cluster 将数据自动划分为 16384 个槽（slots），每个槽都可以存储键值对。这些槽会被分配到多个 Redis 节点上，通过哈希函数将键映射到相应的槽，再由槽映射到具体的 Redis 节点。

## redis的一致性问题

对于读数据，我会选择旁路缓存策略，如果 cache 不命中，会从 db 加载数据到 cache。对于写数据，我会选择更新 db 后，再删除缓存

缓存是通过牺牲强一致性来提高性能的。这是由**CAP理论**决定的。缓存系统适用的场景就是非强一致性的场景，它属于CAP中的AP。所以，如果需要数据库和缓存数据保持强一致，就不适合使用缓存。

缓存为什么要设置过期时间，设置的时间长短有什么好处坏处。

太短了，缓存作用就不大了。

太长了，脏数据保存的时间就比较长。脏数据哪儿来的呢？按照上面我们的更新逻辑，删除缓存失败。

可以通过其他办法来保证最终一致性，比如重试删除。通过把删除的命令放入消息队列，消息消费失败则重新读取，超过一定次数向业务层报警；删除成功就从消息队列中删除。

### 缓存击穿 穿透 雪崩

缓存击穿：数据过期后，数据大量打到数据库里面。  热点数据永不过期;互斥锁方案，只有一个请求能请求数据库，其他的只能请求缓存。

缓存穿透：当用户访问的数据，**既不在缓存中，也不在数据库中**，所以每次请求缓存后都会请求数据库。

在缓存中设置一个空的返回值；限制非法请求；过滤器，例如bulong过滤器，由点位图和多个哈希函数组成。

先查询过滤器，再查询数据。由于布隆过滤器存在哈希冲突，可能过滤器认为存在但是实际不存在。

缓存雪崩：大量缓存数据在同一时间过期（失效）或者 Redis 故障宕机时，如果此时有大量的用户请求，都无法在 Redis 中处理，于是全部请求都直接访问数据库

均匀设置过期时间，构建redis集群的稳定性（主从等）



## Redis是单线程吗？为什么



## Redis 大key对持久化的影响