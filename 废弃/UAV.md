# 代码复现

[GitHub - hbayerlein/uav_data_harvesting: Python implementation of DDQN multi-UAV data harvesting](https://github.com/hbayerlein/uav_data_harvesting)

这是东南大学一个博士用pytorch重

本地直接运行很容易，依赖的文件很少

![image-20231118203511776](images/image-20231118203511776.png)

但是需要的时间较多，考虑服务器运行



AutoDL  3080服务器 pytorch2.0版本的基本配置





source /etc/network_turbo  学术加速

//git clone https://github.com/hbayerlein/uav_data_harvesting.git

git clone https://github.com/superheroYu/RL_UAV_CPPandDHMulti.git

pip install -U scikit-image

-U的意思将所有指定的程序包升级到最新的可用版本。依赖项的处理取决于所使用的升级策略

大概率是原有的版本不对，都用最新版本就可以了，就几个依赖。



经过一番折腾，因为本机已经可以运行了，所以从本机导出依赖，进行少量修改后，直接导入

pip install pipreqs  安装某导出依赖工具

pipreqs ./ --encoding=utf8 --force  导出依赖



上传后 pip install -r requirements.txt

这个工具并不算很好用，有一定问题，直接导出的

```
matplotlib==3.5.1
numpy==1.24.1
opencv_python==4.7.0.72
skimage==0.0
tensorboard==2.10.0
torch==2.1.0.dev20230313+cu118
torchvision==0.15.0.dev20230313+cu118
tqdm==4.65.0
~umpy==1.21.5
```

最后修改后使用的

```
matplotlib==3.5.1
numpy==1.24.1
opencv_python==4.7.0.72
tensorboard==2.10.0
torch==2.1.0
torchvision
tqdm==4.65.0
```

其中出现了版本冲突，我选择删掉版本制定，让pip自动解决冲突

之后就可以运行了

```javascript
nohup python train.py --target DHMulti --config config/manhattan32_DHMulti.json --id manhattan32_DHMulti &
```

失败，尝试使用screen

#应该不用ssh连接，用juypter一样的 ssh -p 24360 root@region-42.seetacloud.com

**Screen基本操作**

创建会话

screen -S <名字>

退出当前

键盘点击ctrl+a , 然后按d

查看

screen -ls

进入某个会话

screen -r <会话序列号>

说明:会话序列号可通过screen -ls获得

关闭：

screen -X -S <序列号> quit



screen -S 1118  今天的日期啦

然后screen -ls查看到序列号

进入 screen -r  xxxxx

执行命令

parliamentarian--target DHMulti --config config/manhattan32_DHMulti.json --id manhattan32_DHMulti

直接退出了，重新进去后仍然在运行。大概是成功了把





## 关于 screen 在 ssh 断开时被杀死的问题

前段时间折腾 arch linux 的时候遇到了一个非常无厘头的问题：凡是在 ssh 中开启的 screen ，在 ssh 连接被断开时总会被自动杀死，就像一个普通进程一样。而在实机上开启的 screen 则不存在这样的问题，即使使用 ssh 去访问它也不会遇到断开时被杀死的问题。
这个问题真的非常神奇，众所周知 screen 不应该是这样的。我查了很多资料都没有结果，但是其中的一个帖子提供了一些解决方案，即使这个帖子中提到的问题原因似乎并不适用我所遇到的情况（配置和服务的选择并不存在问题，我怀疑是不是 systemd 的上游哪里改炸了）。

https://unix.stackexchange.com/questions/171503/tmux-session-killed-when-disconnecting-from-ssh

但总而言之，systemd 把 ssh 会话和 screen 进行了绑定，导致 screen 会被连带杀死。

# 论文查找

谷歌学术搜索关键词

IEEE Transactions on Communications，IEEE Transactions on Wireless Communications官网搜

gpt4.0联网搜索

# Latex使用

从ieee官网下载模板

https://journals.ieeeauthorcenter.ieee.org/create-your-ieee-journal-article/authoring-tools-and-templates/tools-for-ieee-authors/ieee-article-templates/

这里选择TWC模板

![image-20231202194000645](images/image-20231202194000645.png)

https://cn.overleaf.com/导入下载模板

https://tablesgenerator.com/ 在线表格转latex格式

https://latex.91maths.com/ 在线公式转latex格式

图片：

参考文献

# 行文逻辑

**无人机在边缘计算方面有应用前景。**引用其他研究介绍：无人机可以被视为用户/中继/MEC-服务器，通过适当地利用网络边缘的计算资源来减少处理延迟并提高利用效率，并且可以显着提高无人机使能的边缘计算网络的性能balabal......

**随着边缘计算网络的发展，有了更高的要求**。引用其他研究介绍....得出结论，痛点问题在于用户请求计算任务的**时延**，无人机的**能耗**。此外考虑可能存在窃听者，需要有**保密率**的约束

充分利用无人机，无人机可以在干扰，计算，传输中转换角色，考虑整个网络范围全局最优，通过无人机与近地卫星通信，卫星实时获取无人机位置和状态，进行位置和状态的控制（有点强行蹭**空天地网络**）。

已知无人机的数量，计算需求。通过优化无人机位置，无人机在某个时刻的角色，无人机发射功率。求约束条件下，算任务的**时延**，无人机的**能耗**联合最优。

**时延**：发送数据+计算+回传    

发送数据时间于用户和选择的计算无人机位置相关，与计算任务本身大小有关。无空闲无人机可能需要等待，涉及到角色转化。等待时间+距离/速度+任务大小/传输速率

所有无人机相同，计算时间恒定

电磁波传输速度很快，传递和回传时间基本忽略

**时延最优**=请求等待min+计算卸载min

**能耗**：悬停+计算+发射干扰+传输信息

悬停能耗不考虑优化，整个实验范围内所有无人机在电池约束条件>0

所有无人机相同，计算能耗恒定

作为干扰无人机时，干扰的发射功率影响能耗

传输信息的功率影响能耗，距离越远需要的发射功率越大，与信道模型相关

**能耗最优**=发射干扰min+传输信息min

其中约束条件包括：

1.无人机有四种状态，计算，传输信息，干扰窃听者，空闲，每个时刻为其中一种状态

2.一个计算子任务只能在一个无人机上计算

3.无人机电池在所有时刻>0

4.用户计算任务和无人机之间距离限制

5.用户传输信息到另外一个用户的距离限制

6.同一时刻，一个无人机最多给一个无人机提供干扰服务，一个无人机只能被一个无人提供干扰服务

7.一个无人机给另外一个无人机提供抗干扰服务，有距离限制

8.所有无人机处于卫星覆盖范围内

9.无人机传输信息保密率大于x

## 实验

用户和无人机通信距离限制和无人机位置相关，地面用户和窃听者可以视为不移动。无人机的位置和角色，不依赖于发射功率，但是发射功率依赖于无人机位置和角色。将整个任务分解成两个部分。

思路：

强化学习优化的目标：希望无人机尽可能少移动，与目标用户距离不宜过大，否在需要移动到范围内，合理的角色转化，让用户的任务请求尽早被计算，尽可能每次传输有无人机充当干扰。确定无人机在每个时刻的位置，以及每个时刻的状态（角色）。

凸优化的方法：最优化发射功率。

离散空间，高度固定，水平移动，不考虑无法悬停的位置（障碍或其他情况）

1.动态规划求位置和角色+凸优化求发射功率（相当于穷举，作为验证）

2.固定角色，强化学习求无人机位置+凸优化求发射功率（作为对比，凸显这个角色转化策略的优势）

3.ddpg强化学习求无人机位置和角色转化+凸优化求发射功率

无人机数量：10     30      50

3*3 9组实验

希望得到的实验结果，ddpg-g强化学习求无人机位置和角色转化+凸优化求发射功率总是优于固定角色的，并且随着无人机数量提升效果提升显著

## 疑惑：

扯空天地网络是不是太牵强？仅仅是可以和所有无人机通信，然后控制，这个成本高不高

没有什么创新点？杂糅了角色转化，空天地网络，计算卸载，本身似乎没有新意

直接确定位置，不管轨迹会不会有问题？

对比实验是否没有说服力，需要再加几组？可以考虑再加不同的强化学习方法

凸优化是否好解？我看到过很多知道无人机轨迹位置来确认发射功率的文章，但是没仔细去看过别人写的公式，乍一看是感觉完全看不懂的。

100

1 u1        5 u2         10u1 

# 思路整理

主要参考文献

A：Multi-UAV Cooperative Task Offloading and Resource Allocation in 5G Advanced and Beyond

5G先进及以后的多无人机协同任务卸载和资源分配

B：Dynamic Role Switching Scheme with Joint Trajectory and Power Control for Multi-UAV Cooperative Secure Communication

多无人机协同安全通信中具有联合轨迹和功率控制的动态角色切换方案

C：Hierarchical Bandwidth Allocation for Social Community-Oriented Multicast in Space-Air-Ground Integrated Networks

空-地综合网络中面向社会群体的多播分级带宽分配

以下简称A，B，C

## 系统模型

参考A中的无人机协同计算，考虑B中有窃听者的问题，以及C中近地卫星和无人机的通信

分三层

空中层：无人机负责与地面用户通信，进行边缘计算，考虑窃听无人机可发送干扰信号

空间层：近地卫星负责管理无人机，提供一个全局位置信息，位置调度，计算资源整合，无人机干扰角色转化

地面用户：需求方，可以通过无人机实现边缘计算，和其他用户通信

## 信道模型

### air to groud

参考A

实际环境中有障碍物，所以考虑了LoS和非LoS（NLoS）通信的发生概率和路径损耗，为G2A通信提供了全面的表征。

![image-20231204183505040](images/image-20231204183505040.png)

得到路径损耗建模

![image-20231204183937027](images/image-20231204183937027.png)

得到平均损耗

![image-20231204184012072](images/image-20231204184012072.png)

得到计算任务的传输速率为

![image-20231204184213203](images/image-20231204184213203.png)

其中信道增益是平均损耗的倒数![image-20231204184237236](images/image-20231204184237236.png)

### ground to ground

参考A

地面设备之间的通信由Los链路主导，传输速率为：

![image-20231204184516035](images/image-20231204184516035.png)

其中![image-20231204184534811](images/image-20231204184534811.png)

### space to air

主要参考C

LEO卫星可以提供具有大带宽的低延迟内容递送服务。
假设低轨卫星和无人机之间的S2A通信链路是可预测的，采用威布尔信道模型。并在一定时间内保持相对稳定。它们之间的距离可以近似为低轨卫星的高度（即Ho）。
卫星对无人机的发射功率稳定

![image-20231204163429596](images/image-20231204163429596.png)

所以传输速率

![image-20231204163538058](images/image-20231204163538058.png)

## 问题描述

约束条件下联合优化（非凸）问题，用强化学习的方法解

### 约束条件

1.无人机有四种状态，计算，传输信息，干扰窃听者，空闲，每个时刻为其中一种状态

2.一个计算子任务只能在一个无人机上计算

3.无人机电池在所有时刻>0

4.用户计算任务和无人机之间距离限制

5.用户传输信息到另外一个用户的距离限制

6.同一时刻，一个无人机最多给一个无人机提供干扰服务，一个无人机只能被一个无人提供干扰服务

7.一个无人机给另外一个无人机提供抗干扰服务，有距离限制

8.所有无人机处于卫星覆盖范围内

在问题P1中，约束条件C1和C2表示计算任务卸载和地面D2D关联策略是二元变量。约束C3规定子任务只能在集合V中的一个计算UAV上计算。约束C4规定用户设备只能将任务传输到同一无人机覆盖的另一用户设备。约束C5和C6分别保证无人机管理器和计算无人机消耗的能量必须低于固定阈值e0。注意，由于非凸方程（20），P1不容易求解。约束C7和C8表示G2A通信距离约束和D2D通信距离约束。通常，枚举方法被广泛用于解决P1的这类问题并获得最优解。然而，它的计算复杂度非常高，即O（n+（mn）|V|），它被用作基准方法来证明我们提出的方案的有效性。

c1,c2 计算任务卸载和地面关联

c3  任务和无人机一对一

c4 干扰无人机和传输一对一

c5 无人机有点

c6 ,c7分别是无人机和用户的距离，干扰无人机和无人机

c8 无人机在卫星覆盖范围内

### 给定条件

用户数量，每个用户某时刻计算量需求，无人机数量

ddpg-g

### 优化变量

无人机的位置，无人机的作用（计算，传输，干扰之间的转化），设备的发射功率

### 目标

计算延迟最小（发送数据+计算+回传 min），保密率最高，无人机能耗最小

**方法**

强化学习的多目标优化，优化多无人机的路径，角色转化，使三个优化目标均衡最优

多目标权重怎么定？查一些资料，然后一顿扯，得出xxx，最后实验里面手动定权重，例如0.4 0.2 0.4这样子 

路径优化怎么优化？离散空间还是连续空间？

角色转化问题？这个应该不用考虑，强化学习可以根据reward自动去选择

**简化版方法**

能耗和延迟 

强化学习 以计算延迟最小为目标，确定角色以及轨道（位置）。保密率作为约束条件 0.8，凸优化解决无人机能耗问题。

# 格式问题

**注意中英文的句号等各种符号规范不要混着用**

**一些符号，大小写，英文字母，希腊字母有规范**

斜体：变量，函数符号等。**在语句中仍然要保持斜体**

粗体：向量，张量，矩阵等多维的物理量

罗马体（正文体）：不符合粗体和斜体的要求的都用罗马体

# 

introduction to the internet  

